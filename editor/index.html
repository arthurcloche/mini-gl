<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>miniGL Editor Prototype</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="editor-container">
        <!-- Left Column: Scene Graph + Node Palette -->
        <div class="left-panel">
            <!-- Scene Graph -->
            <div class="scene-graph">
                <div class="panel-header">
                    <h3>Scene Graph</h3>
                    <div class="scene-info">
                        <span class="info-text">Read Only</span>
                    </div>
                </div>
                <div class="scene-content">
                    <div class="scene-node">
                        <span class="node-icon">üìä</span>
                        <span class="node-name editable" contenteditable="false">Main Output</span>
                        <div class="node-actions">
                            <button class="action-btn" title="Rename">‚úèÔ∏è</button>
                            <button class="action-btn" title="Copy">üìã</button>
                            <button class="action-btn" title="Delete">üóëÔ∏è</button>
                        </div>
                    </div>
                    <div class="scene-node indent">
                        <span class="node-icon">üé®</span>
                        <span class="node-name editable" contenteditable="false">Bloom Effect</span>
                        <div class="node-actions">
                            <button class="action-btn" title="Rename">‚úèÔ∏è</button>
                            <button class="action-btn" title="Copy">üìã</button>
                            <button class="action-btn" title="Delete">üóëÔ∏è</button>
                        </div>
                    </div>
                    <div class="scene-node indent-2">
                        <span class="node-icon">‚ö°</span>
                        <span class="node-name editable" contenteditable="false">Blur H</span>
                        <div class="node-actions">
                            <button class="action-btn" title="Rename">‚úèÔ∏è</button>
                            <button class="action-btn" title="Copy">üìã</button>
                            <button class="action-btn" title="Delete">üóëÔ∏è</button>
                        </div>
                    </div>
                    <div class="scene-node indent-2">
                        <span class="node-icon">‚ö°</span>
                        <span class="node-name editable" contenteditable="false">Blur V</span>
                        <div class="node-actions">
                            <button class="action-btn" title="Rename">‚úèÔ∏è</button>
                            <button class="action-btn" title="Copy">üìã</button>
                            <button class="action-btn" title="Delete">üóëÔ∏è</button>
                        </div>
                    </div>
                    <div class="scene-node indent">
                        <span class="node-icon">üñºÔ∏è</span>
                        <span class="node-name editable" contenteditable="false">Source Texture</span>
                        <div class="node-actions">
                            <button class="action-btn" title="Rename">‚úèÔ∏è</button>
                            <button class="action-btn" title="Copy">üìã</button>
                            <button class="action-btn" title="Delete">üóëÔ∏è</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Node Palette -->
            <div class="node-palette">
                <div class="panel-header">
                    <h3>Node Palette</h3>
                </div>
                <div class="palette-content">
                    <div class="node-category">
                        <h4>Input</h4>
                        <div class="node-item" draggable="true" data-node-type="Texture">
                            <span class="node-icon">üñºÔ∏è</span>
                            <span class="node-name">Texture</span>
                            <button class="add-node-btn">Add</button>
                        </div>
                        <div class="node-item" draggable="true" data-node-type="Video">
                            <span class="node-icon">üìπ</span>
                            <span class="node-name">Video</span>
                            <button class="add-node-btn">Add</button>
                        </div>
                        <div class="node-item" draggable="true" data-node-type="Canvas">
                            <span class="node-icon">üìä</span>
                            <span class="node-name">Canvas</span>
                            <button class="add-node-btn">Add</button>
                        </div>
                    </div>
                    <div class="node-category">
                        <h4>Core Nodes</h4>
                        <div class="node-item" draggable="true" data-node-type="Shader">
                            <span class="node-icon">‚ö°</span>
                            <span class="node-name">Shader</span>
                            <button class="add-node-btn">Add</button>
                        </div>
                        <div class="node-item" draggable="true" data-node-type="Blend">
                            <span class="node-icon">üé®</span>
                            <span class="node-name">Blend</span>
                            <button class="add-node-btn">Add</button>
                        </div>
                        <div class="node-item" draggable="true" data-node-type="Feedback">
                            <span class="node-icon">üîÑ</span>
                            <span class="node-name">Feedback</span>
                            <button class="add-node-btn">Add</button>
                        </div>
                    </div>
                    <!-- MiniNodes hidden for now -->
                    <!--
                    <div class="node-category">
                        <h4>MiniNodes</h4>
                        <div class="node-item" draggable="true" data-node-type="Blur">
                            <span class="node-icon">üå∏</span>
                            <span class="node-name">Blur</span>
                            <button class="add-node-btn">Add</button>
                        </div>
                        <div class="node-item" draggable="true" data-node-type="Bloom">
                            <span class="node-icon">‚ú®</span>
                            <span class="node-name">Bloom</span>
                            <button class="add-node-btn">Add</button>
                        </div>
                        <div class="node-item disabled">
                            <span class="node-icon">üîÆ</span>
                            <span class="node-name">Custom Effects...</span>
                        </div>
                    </div>
                    -->
                </div>
            </div>
        </div>

        <!-- Center Column: Preview + Node Graph -->
        <div class="center-panel">
            <!-- Preview Canvas -->
            <div class="preview-panel">
                <div class="panel-header">
                    <div class="preview-controls">
                        <button class="control-btn">pause</button>
                        <button class="control-btn">reset</button>
                        <button class="control-btn record-btn" id="recordBtn">record</button>
                    </div>
                    <div class="preview-stats">
                        <div class="fps-indicator">60 FPS</div>
                        <div class="frame-indicator">Frame: <span id="frameCount">0</span></div>
                    </div>
                </div>
                <div class="preview-canvas">
                    <canvas id="preview" width="512" height="512"></canvas>
                </div>
            </div>

            <!-- Node Graph -->
            <div class="node-graph" id="nodeGraph">
                <div class="panel-header">
                    <h3>Node Graph</h3>
                    <div class="output-selector">
                        <label>Output:</label>
                        <select class="output-dropdown">
                            <option value="blur">Blur Effect</option>
                            <option value="source">Source</option>
                            <option value="blend">Blend Result</option>
                        </select>
                    </div>
                    <div class="graph-controls">
                        <button class="control-btn">zoom</button>
                        <button class="control-btn">grid</button>
                        <button class="control-btn">center</button>
                    </div>
                </div>
                <div class="graph-canvas">
                    <svg class="graph-svg" width="100%" height="100%">
                        <!-- Connection Lines (straight) -->
                        <line x1="140" y1="70" x2="260" y2="70" class="connection-line" />
                        <line x1="380" y1="100" x2="460" y2="120" class="connection-line" />
                        <line x1="380" y1="120" x2="460" y2="140" class="connection-line" />
                        
                        <!-- Sample Nodes -->
                        <g class="graph-node draggable" transform="translate(20, 40)" data-node-id="source">
                            <rect class="node-body" width="120" height="60" rx="4" />
                            <text class="node-title" x="60" y="20">Source</text>
                            <text class="node-type" x="60" y="35">Texture</text>
                            <circle class="node-output" cx="115" cy="30" r="4" />
                        </g>
                        
                        <g class="graph-node draggable selected" transform="translate(260, 60)" data-node-id="blur">
                            <rect class="node-body" width="120" height="80" rx="4" />
                            <text class="node-title" x="60" y="20">Blur Effect</text>
                            <text class="node-type" x="60" y="35">Shader</text>
                            <circle class="node-input" cx="5" cy="30" r="4" />
                            <circle class="node-output" cx="115" cy="40" r="4" />
                        </g>
                        
                        <g class="graph-node draggable" transform="translate(460, 100)" data-node-id="output">
                            <rect class="node-body" width="120" height="80" rx="4" />
                            <text class="node-title" x="60" y="20">Final Output</text>
                            <text class="node-type" x="60" y="35">Blend</text>
                            <circle class="node-input" cx="5" cy="30" r="4" />
                            <circle class="node-input" cx="5" cy="50" r="4" />
                        </g>
                    </svg>
                </div>
            </div>
            
            <!-- Shader Editor Overlay (hidden by default) -->
            <div class="shader-overlay" id="shaderOverlay" style="display: none;">
                <div class="shader-panel">
                    <div class="panel-header">
                        <h3>Fragment Shader Editor</h3>
                        <div class="shader-controls">
                            <button class="control-btn test-btn">test</button>
                            <button class="control-btn run-btn">run</button>
                            <button class="close-btn" onclick="toggleShaderPanel()">‚úï</button>
                        </div>
                    </div>
                    <div class="shader-editor">
                        <textarea class="code-editor" rows="25">
#version 300 es
precision highp float;

uniform vec2 glResolution;
uniform float glTime;
uniform sampler2D uTexture;

in vec2 glCoord;
in vec2 glUV;
out vec4 fragColor;

void main() {
    vec2 uv = glUV;
    vec4 color = texture(uTexture, uv);
    
    // Simple blur effect
    vec2 texelSize = 1.0 / glResolution;
    vec4 blur = vec4(0.0);
    
    for(int x = -2; x <= 2; x++) {
        for(int y = -2; y <= 2; y++) {
            blur += texture(uTexture, uv + vec2(x, y) * texelSize);
        }
    }
    
    fragColor = blur / 25.0;
}
                        </textarea>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column: Properties Panel -->
        <div class="right-panel">
            <!-- Node Properties (when node selected) -->
            <div class="properties-panel" id="nodeProperties">
                <div class="panel-header">
                    <h3>Blur Effect Properties</h3>
                </div>
                <div class="properties-content">
                    <div class="property-group">
                        <h4>Uniforms</h4>
                        <div class="property-item">
                            <label>uRadius</label>
                            <div class="uniform-controls">
                                <select class="uniform-type">
                                    <option value="slider">Slider</option>
                                    <option value="constant">Constant</option>
                                    <option value="sine">Sine</option>
                                    <option value="toggle">Toggle</option>
                                </select>
                                <input type="range" min="0" max="10" value="2" class="slider">
                                <span class="value">2.0</span>
                            </div>
                        </div>
                        <div class="property-item">
                            <label>uIntensity</label>
                            <div class="uniform-controls">
                                <select class="uniform-type">
                                    <option value="slider">Slider</option>
                                    <option value="constant">Constant</option>
                                    <option value="sine">Sine</option>
                                    <option value="toggle">Toggle</option>
                                </select>
                                <input type="range" min="0" max="2" step="0.1" value="1" class="slider">
                                <span class="value">1.0</span>
                            </div>
                        </div>
                        <button class="add-uniform-btn">+ Add Uniform</button>
                    </div>
                    
                    <div class="property-group">
                        <h4>Inputs</h4>
                        <div class="input-item">
                            <label>uTexture</label>
                            <select class="input-source">
                                <option value="source">Source</option>
                                <option value="video1">Video Node</option>
                                <option value="canvas1">Canvas Node</option>
                            </select>
                            <button class="remove-input">‚úï</button>
                        </div>
                        <button class="add-input-btn">+ Add Input</button>
                    </div>
                    
                    <div class="property-group">
                        <h4 class="collapsible-header">Advanced <span class="toggle">+</span></h4>
                        <div class="collapsible-content" style="display: none;">
                            <div class="property-item">
                                <label>Precision</label>
                                <select class="dropdown">
                                    <option value="float">Float</option>
                                    <option value="unsigned">Unsigned</option>
                                </select>
                            </div>
                            <div class="property-item">
                                <label>Min Filter</label>
                                <select class="dropdown">
                                    <option value="linear">Linear</option>
                                    <option value="nearest">Nearest</option>
                                </select>
                            </div>
                            <div class="property-item">
                                <label>Mag Filter</label>
                                <select class="dropdown">
                                    <option value="linear">Linear</option>
                                    <option value="nearest">Nearest</option>
                                </select>
                            </div>
                            <div class="property-item">
                                <label>Mipmaps</label>
                                <input type="checkbox" checked class="checkbox">
                            </div>
                            <div class="property-item">
                                <label>Clamping</label>
                                <select class="dropdown">
                                    <option value="clamp">Clamp</option>
                                    <option value="repeat">Repeat</option>
                                    <option value="mirror">Mirror</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings/Export Panel at bottom -->
            <div class="bottom-panel">
                <div class="panel-tabs">
                    <button class="tab-btn active" data-tab="settings">Settings</button>
                    <button class="tab-btn" data-tab="export">Export</button>
                </div>
                
                <div class="tab-content" id="settingsTab">
                    <div class="settings-content">
                        <div class="property-group">
                            <h4>Canvas</h4>
                            <div class="property-item">
                                <label>Resolution</label>
                                <select class="dropdown" id="resolutionSelect">
                                    <option value="512x512">512x512</option>
                                    <option value="1024x1024">1024x1024</option>
                                    <option value="1920x1080">1920x1080</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="property-group">
                            <h4>Animation</h4>
                            <div class="property-item">
                                <label>Loop</label>
                                <input type="checkbox" class="checkbox" id="loopCheckbox">
                            </div>
                            <div class="property-item">
                                <label>Duration (s)</label>
                                <select class="dropdown" id="loopDuration" disabled>
                                    <option value="4">4</option>
                                    <option value="8">8</option>
                                    <option value="12">12</option>
                                    <option value="24">24</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="property-group">
                            <h4>Performance</h4>
                            <div class="property-item">
                                <label>Preferred Performance</label>
                                <select class="dropdown">
                                    <option value="auto">Auto</option>
                                    <option value="high">High</option>
                                    <option value="medium">Medium</option>
                                    <option value="low">Low</option>
                                </select>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Current Load</span>
                                <span class="stat-value medium">Medium</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">FPS</span>
                                <span class="stat-value">60</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="tab-content" id="exportTab" style="display: none;">
                    <div class="export-content">
                        <div class="property-group">
                            <h4>Project</h4>
                            <div class="property-item">
                                <label>Name</label>
                                <input type="text" value="Untitled Project" class="text-input">
                            </div>
                        </div>
                        
                        <div class="property-group">
                            <h4>Recording</h4>
                            <div class="property-item">
                                <label>Format</label>
                                <select class="dropdown">
                                    <option>MP4</option>
                                    <option>WebM</option>
                                    <option>GIF</option>
                                </select>
                            </div>
                            <div class="property-item">
                                <label>Duration (s)</label>
                                <input type="number" value="5" min="1" max="60" class="number-input" id="recordDuration">
                            </div>
                            <div class="property-item">
                                <label>Quality</label>
                                <select class="dropdown">
                                    <option>High</option>
                                    <option>Medium</option>
                                    <option>Low</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="export-actions">
                            <button class="export-btn record">Record</button>
                            <button class="export-btn snapshot">Snapshot</button>
                            <button class="json-export-btn" onclick="exportGraphAsJSON()">Export as JSON</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Include miniGL as a module -->
    <script type="module">
        import miniGL from '../lib/miniGL/miniGL.js';
        window.miniGL = miniGL;
    </script>
    <script type="module" src="src/app.js"></script>
</body>
</html>